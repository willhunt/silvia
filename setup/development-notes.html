<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Notes | Silviabot Documentation</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Silviabot smart espresso machine">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/silvia/assets/css/0.styles.84c15d8c.css" as="style"><link rel="preload" href="/silvia/assets/js/app.58b51180.js" as="script"><link rel="preload" href="/silvia/assets/js/2.216158cf.js" as="script"><link rel="preload" href="/silvia/assets/js/21.d7a4d73e.js" as="script"><link rel="prefetch" href="/silvia/assets/js/10.1d3113f7.js"><link rel="prefetch" href="/silvia/assets/js/11.e3890126.js"><link rel="prefetch" href="/silvia/assets/js/12.6ae84a4f.js"><link rel="prefetch" href="/silvia/assets/js/13.90f118ae.js"><link rel="prefetch" href="/silvia/assets/js/14.e55e6256.js"><link rel="prefetch" href="/silvia/assets/js/15.85a719c5.js"><link rel="prefetch" href="/silvia/assets/js/16.135070dd.js"><link rel="prefetch" href="/silvia/assets/js/17.b37ec67f.js"><link rel="prefetch" href="/silvia/assets/js/18.10500e0d.js"><link rel="prefetch" href="/silvia/assets/js/19.9a8bea67.js"><link rel="prefetch" href="/silvia/assets/js/20.2b4676e2.js"><link rel="prefetch" href="/silvia/assets/js/22.6c7c5b00.js"><link rel="prefetch" href="/silvia/assets/js/23.ad97dde0.js"><link rel="prefetch" href="/silvia/assets/js/3.f01c0106.js"><link rel="prefetch" href="/silvia/assets/js/4.02721f6a.js"><link rel="prefetch" href="/silvia/assets/js/5.267c1543.js"><link rel="prefetch" href="/silvia/assets/js/6.6da585be.js"><link rel="prefetch" href="/silvia/assets/js/7.05a1fa71.js"><link rel="prefetch" href="/silvia/assets/js/8.4531bd28.js"><link rel="prefetch" href="/silvia/assets/js/9.fedc342e.js">
    <link rel="stylesheet" href="/silvia/assets/css/0.styles.84c15d8c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/silvia/" class="home-link router-link-active"><!----> <span class="site-name">Silviabot Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/silvia/demo/" class="nav-link">
  Demo
</a></div><div class="nav-item"><a href="/silvia/setup/" class="nav-link router-link-active">
  Setup
</a></div><div class="nav-item"><a href="/silvia/build/" class="nav-link">
  Build
</a></div><div class="nav-item"><a href="https://github.com/willhunt/silvia" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/silvia/demo/" class="nav-link">
  Demo
</a></div><div class="nav-item"><a href="/silvia/setup/" class="nav-link router-link-active">
  Setup
</a></div><div class="nav-item"><a href="/silvia/build/" class="nav-link">
  Build
</a></div><div class="nav-item"><a href="https://github.com/willhunt/silvia" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Setup</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/silvia/setup/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/silvia/setup/control-setup.html" class="sidebar-link">Temperature Control</a></li><li><a href="/silvia/setup/raspi-setup.html" class="sidebar-link">Pi Setup</a></li><li><a href="/silvia/setup/arduino-setup.html" class="sidebar-link">Arduino Setup</a></li><li><a href="/silvia/setup/scale-setup.html" class="sidebar-link">Scale Setup</a></li><li><a href="/silvia/setup/development-notes.html" aria-current="page" class="active sidebar-link">Notes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/silvia/setup/development-notes.html#update-files" class="sidebar-link">Update files</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/development-notes.html#django" class="sidebar-link">Django</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/development-notes.html#message-broker" class="sidebar-link">Message broker</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/development-notes.html#supervisor" class="sidebar-link">Supervisor</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/development-notes.html#apache" class="sidebar-link">Apache</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/development-notes.html#arduino-from-pi" class="sidebar-link">Arduino from Pi</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/development-notes.html#pi-errors" class="sidebar-link">Pi Errors</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/development-notes.html#scale" class="sidebar-link">Scale</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/development-notes.html#changing-database-to-postgresql" class="sidebar-link">Changing Database to PostgreSQL</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/development-notes.html#gitignore-changes" class="sidebar-link">.gitignore changes</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="notes"><a href="#notes" class="header-anchor">#</a> Notes</h1> <p>Notes on development and debugging commands. For the authors reference mainly!</p> <h2 id="update-files"><a href="#update-files" class="header-anchor">#</a> Update files</h2> <p>Scripts are used to fetch latest updates and collect static files. If &lt;branch name&gt; is empty, defaults to &quot;master&quot;.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> silvia
$ ./update_branch <span class="token operator">&lt;</span>branch name<span class="token operator">&gt;</span>
</code></pre></div><h2 id="django"><a href="#django" class="header-anchor">#</a> Django</h2> <p>Run django dev server on pi</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ python manage.py runserver <span class="token number">192.168</span>.0.9:8000 
</code></pre></div><h2 id="message-broker"><a href="#message-broker" class="header-anchor">#</a> Message broker</h2> <h3 id="useful-redis-commands"><a href="#useful-redis-commands" class="header-anchor">#</a> Useful Redis commands</h3> <p>Start Redis server</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> redis-server <span class="token comment"># Start!</span>
</code></pre></div><p>Clear queues</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ redis-cli flushall
</code></pre></div><h3 id="celery"><a href="#celery" class="header-anchor">#</a> Celery</h3> <p>Start celery and celery-beat</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> ~/silvia/silvia
$ celery -A silvia worker -l info
$ celery -A silvia beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler
</code></pre></div><p>Inspect celery using flower</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> ~/silvia/silvia
$ flower -A silvia
</code></pre></div><h2 id="supervisor"><a href="#supervisor" class="header-anchor">#</a> Supervisor</h2> <p>Start</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> supervisord -c /etc/supervisor/supervisord.conf
</code></pre></div><p>See processes</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> supervisorctl
</code></pre></div><p>Restart processes</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$  x celery_workers:silvia_worker1
</code></pre></div><p>Stop/start all</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> supervisorctl stop all
$ <span class="token function">sudo</span> supervisorctl start all
</code></pre></div><p>Reload config</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> supervisorctl reread
$ <span class="token function">sudo</span> supervisorctl update
</code></pre></div><p>Inspect logs:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">tail</span> /var/log/celery/silvia_worker.log
$ <span class="token function">tail</span> /var/log/celery/silvia_beat.log
</code></pre></div><h2 id="apache"><a href="#apache" class="header-anchor">#</a> Apache</h2> <p>Apache can be restarted using:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">service</span> apache2 restart
</code></pre></div><p>Or stopped:</p> <div class="language-ash extra-class"><pre class="language-text"><code>$ sudo service apache2 stop
</code></pre></div><p>Check log errors usuing:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nano</span> /var/log/apache2/error.log
</code></pre></div><h2 id="arduino-from-pi"><a href="#arduino-from-pi" class="header-anchor">#</a> Arduino from Pi</h2> <p>See serial output. If not installed, install screen:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">screen</span>
</code></pre></div><p>Then view serial output:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">screen</span> /dev/ttyACM0 <span class="token number">9600</span>
</code></pre></div><p>To stop:
'CTRL+a' and then 'k' then 'y'</p> <h2 id="pi-errors"><a href="#pi-errors" class="header-anchor">#</a> Pi Errors</h2> <p>I/O error fix (read only file system):</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">touch</span> /boot/forcefsck
$ <span class="token function">sudo</span> <span class="token function">shutdown</span> -r now
</code></pre></div><h2 id="scale"><a href="#scale" class="header-anchor">#</a> Scale</h2> <h3 id="display-images"><a href="#display-images" class="header-anchor">#</a> Display Images</h3> <p>XBM images can be converted at: <a href="https://www.online-utility.org/image/convert/to/XBM" target="_blank" rel="noopener noreferrer">www.online-utility.org<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="changing-database-to-postgresql"><a href="#changing-database-to-postgresql" class="header-anchor">#</a> Changing Database to PostgreSQL</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> postgresql libpq-dev postgresql-client postgresql-client-common python-dev -y
$ pip <span class="token function">install</span> psycopg2
$ <span class="token builtin class-name">cd</span> ~/silvia/silvia
$ python manage.py dumpdata --exclude<span class="token operator">=</span>contenttypes --exclude<span class="token operator">=</span>auth.Permission <span class="token operator">&gt;</span> datadump.json
</code></pre></div><p>Test connection:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">su</span> - postgres
$ psql
$ CREATE DATABASE silviadatabase<span class="token punctuation">;</span>
$ CREATE <span class="token environment constant">USER</span> databaseadmin WITH PASSWORD <span class="token string">'databasepwd'</span><span class="token punctuation">;</span>
$ ALTER ROLE databaseadmin SET client_encoding TO <span class="token string">'utf8'</span><span class="token punctuation">;</span>
$ ALTER ROLE databaseadmin SET default_transaction_isolation TO <span class="token string">'read committed'</span><span class="token punctuation">;</span>
$ ALTER ROLE databaseadmin SET timezone TO <span class="token string">'GB'</span><span class="token punctuation">;</span>
$ GRANT ALL PRIVILEGES ON DATABASE silviadatabase TO databaseadmin<span class="token punctuation">;</span>
$ <span class="token punctuation">\</span>q
$ <span class="token builtin class-name">exit</span>
</code></pre></div><p>Change database settings in <code>settings.py</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'silviadatabase',
        'USER': 'databaseadmin',
        'PASSWORD': 'databasepwd',
        'HOST': '127.0.0.1',
        'PORT': '',  # Default
    }
}
</code></pre></div><p>Migrate and recreate superuser</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ python manage.py migrate
$ python manage.py createsuperuser
</code></pre></div><h2 id="gitignore-changes"><a href="#gitignore-changes" class="header-anchor">#</a> .gitignore changes</h2> <p>Remove files from git based upon .gitignore changes</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> <span class="token function">rm</span> -r --cached <span class="token builtin class-name">.</span>
$ <span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
$ <span class="token function">git</span> commit -m <span class="token string">&quot;update files based upon .gitignore changes&quot;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/silvia/setup/scale-setup.html" class="prev">
        Scale Setup
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/silvia/assets/js/app.58b51180.js" defer></script><script src="/silvia/assets/js/2.216158cf.js" defer></script><script src="/silvia/assets/js/21.d7a4d73e.js" defer></script>
  </body>
</html>
