<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Temperature Control | Silviabot Documentation</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Silviabot smart espresso machine">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/silvia/assets/css/0.styles.84c15d8c.css" as="style"><link rel="preload" href="/silvia/assets/js/app.58b51180.js" as="script"><link rel="preload" href="/silvia/assets/js/2.216158cf.js" as="script"><link rel="preload" href="/silvia/assets/js/20.2b4676e2.js" as="script"><link rel="preload" href="/silvia/assets/js/3.f01c0106.js" as="script"><link rel="prefetch" href="/silvia/assets/js/10.1d3113f7.js"><link rel="prefetch" href="/silvia/assets/js/11.e3890126.js"><link rel="prefetch" href="/silvia/assets/js/12.6ae84a4f.js"><link rel="prefetch" href="/silvia/assets/js/13.90f118ae.js"><link rel="prefetch" href="/silvia/assets/js/14.e55e6256.js"><link rel="prefetch" href="/silvia/assets/js/15.85a719c5.js"><link rel="prefetch" href="/silvia/assets/js/16.135070dd.js"><link rel="prefetch" href="/silvia/assets/js/17.b37ec67f.js"><link rel="prefetch" href="/silvia/assets/js/18.10500e0d.js"><link rel="prefetch" href="/silvia/assets/js/19.9a8bea67.js"><link rel="prefetch" href="/silvia/assets/js/21.d7a4d73e.js"><link rel="prefetch" href="/silvia/assets/js/22.6c7c5b00.js"><link rel="prefetch" href="/silvia/assets/js/23.ad97dde0.js"><link rel="prefetch" href="/silvia/assets/js/4.02721f6a.js"><link rel="prefetch" href="/silvia/assets/js/5.267c1543.js"><link rel="prefetch" href="/silvia/assets/js/6.6da585be.js"><link rel="prefetch" href="/silvia/assets/js/7.05a1fa71.js"><link rel="prefetch" href="/silvia/assets/js/8.4531bd28.js"><link rel="prefetch" href="/silvia/assets/js/9.fedc342e.js">
    <link rel="stylesheet" href="/silvia/assets/css/0.styles.84c15d8c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/silvia/" class="home-link router-link-active"><!----> <span class="site-name">Silviabot Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/silvia/demo/" class="nav-link">
  Demo
</a></div><div class="nav-item"><a href="/silvia/setup/" class="nav-link router-link-active">
  Setup
</a></div><div class="nav-item"><a href="/silvia/build/" class="nav-link">
  Build
</a></div><div class="nav-item"><a href="https://github.com/willhunt/silvia" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/silvia/demo/" class="nav-link">
  Demo
</a></div><div class="nav-item"><a href="/silvia/setup/" class="nav-link router-link-active">
  Setup
</a></div><div class="nav-item"><a href="/silvia/build/" class="nav-link">
  Build
</a></div><div class="nav-item"><a href="https://github.com/willhunt/silvia" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Setup</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/silvia/setup/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/silvia/setup/control-setup.html" aria-current="page" class="active sidebar-link">Temperature Control</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/silvia/setup/control-setup.html#proportional-gain" class="sidebar-link">Proportional gain</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/control-setup.html#derivative-gain" class="sidebar-link">Derivative gain</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/control-setup.html#integral-gain" class="sidebar-link">Integral gain</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/control-setup.html#fine-tuning" class="sidebar-link">Fine tuning</a></li><li class="sidebar-sub-header"><a href="/silvia/setup/control-setup.html#chosen-settings" class="sidebar-link">Chosen settings</a></li></ul></li><li><a href="/silvia/setup/raspi-setup.html" class="sidebar-link">Pi Setup</a></li><li><a href="/silvia/setup/arduino-setup.html" class="sidebar-link">Arduino Setup</a></li><li><a href="/silvia/setup/scale-setup.html" class="sidebar-link">Scale Setup</a></li><li><a href="/silvia/setup/development-notes.html" class="sidebar-link">Notes</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="temperature-control"><a href="#temperature-control" class="header-anchor">#</a> Temperature Control</h1> <p>The temperature controller is tuned by adjusting the PID gains. This proved challenging for a number of reasons but a large factor is the time it takes to measure a response to see if long term oscillation is occurring and then to cool the boiler back down again. Some other issues encountered are listed with their resolution:</p> <ul><li>Erratic controller output with high derivative gain
<ul><li>Smoothing temperature measurements using moving average filter</li> <li>Reduce derivative gain and therefore proportional gain (less damping)</li></ul></li> <li>Massive overshoot following brewing
<ul><li>Massive overshoots would occur after a brew cycle, assumed cause being integral windup</li> <li>Brew changed to override PID with maximum output during followed by a controller reset</li></ul></li> <li>Inconsistent and unrepeatable results
<ul><li>Linked to erratic behavior with high derivative gain</li> <li>Also reduced PID update frequency to be slower than temperature update frequency</li></ul></li></ul> <h2 id="proportional-gain"><a href="#proportional-gain" class="header-anchor">#</a> Proportional gain</h2> <p>Some measurements are shown with varying proportional gain.
<div class="docs-image-layout" data-v-76cbf739><div data-v-76cbf739><div class="docs-image-item lg" data-v-39ccd7f2 data-v-76cbf739><div data-v-39ccd7f2><img src="/silvia/assets/setup/setup_tuning_proportional.png" data-v-39ccd7f2></div> <div class="caption" data-v-39ccd7f2>
    Effect of proportional gain
  </div></div></div></div></p> <h2 id="derivative-gain"><a href="#derivative-gain" class="header-anchor">#</a> Derivative gain</h2> <p>Some measurements are shown with varying derivative gain.
<div class="docs-image-layout" data-v-76cbf739><div data-v-76cbf739><div class="docs-image-item lg" data-v-39ccd7f2 data-v-76cbf739><div data-v-39ccd7f2><img src="/silvia/assets/setup/setup_tuning_proportional.png" data-v-39ccd7f2></div> <div class="caption" data-v-39ccd7f2>
    Effect of derivative gain
  </div></div></div></div></p> <h2 id="integral-gain"><a href="#integral-gain" class="header-anchor">#</a> Integral gain</h2> <p>Some measurements are shown with varying integral gain.
<div class="docs-image-layout" data-v-76cbf739><div data-v-76cbf739><div class="docs-image-item lg" data-v-39ccd7f2 data-v-76cbf739><div data-v-39ccd7f2><img src="/silvia/assets/setup/setup_tuning_integral.png" data-v-39ccd7f2></div> <div class="caption" data-v-39ccd7f2>
    Effect of integral gain
  </div></div></div></div></p> <h2 id="fine-tuning"><a href="#fine-tuning" class="header-anchor">#</a> Fine tuning</h2> <p>Using some tuning guidelines a decent response was gained but further tuning was used to account for different setpoints and to improve response to a brew cycle which could overshoot significantly in comparison to the initial warm up.
<div class="docs-image-layout" data-v-76cbf739><div data-v-76cbf739><div class="docs-image-item lg" data-v-39ccd7f2 data-v-76cbf739><div data-v-39ccd7f2><img src="/silvia/assets/setup/setup_tuning_proportional.png" data-v-39ccd7f2></div> <div class="caption" data-v-39ccd7f2>
    Final fine tuning examples
  </div></div></div></div></p> <h2 id="chosen-settings"><a href="#chosen-settings" class="header-anchor">#</a> Chosen settings</h2> <p>The final settings were chosen to allow a small amount of oscillation in order to improve settling time. Using lower gains resulted in unacceptable time to steady state and, as noted, pushing the damping higher (kd) made the controller output very noisy and erratic giving inconsistent results.
<div class="docs-image-layout" data-v-76cbf739><div data-v-76cbf739><div class="docs-image-item lg" data-v-39ccd7f2 data-v-76cbf739><div data-v-39ccd7f2><img src="/silvia/assets/setup/setup_tuning_final.png" data-v-39ccd7f2></div> <div class="caption" data-v-39ccd7f2>
    Final tuning response
  </div></div></div></div></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/silvia/setup/" class="prev router-link-active">
        Introduction
      </a></span> <span class="next"><a href="/silvia/setup/raspi-setup.html">
        Pi Setup
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/silvia/assets/js/app.58b51180.js" defer></script><script src="/silvia/assets/js/2.216158cf.js" defer></script><script src="/silvia/assets/js/20.2b4676e2.js" defer></script><script src="/silvia/assets/js/3.f01c0106.js" defer></script>
  </body>
</html>
