(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{362:function(t,e,a){"use strict";a.r(e);var r=a(42),s=Object(r.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"temperature-control"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#temperature-control"}},[t._v("#")]),t._v(" Temperature Control")]),t._v(" "),a("p",[t._v("The stock Rancillio Silvia uses a thermostat to control the boiler heating element meaning that the temperature fluctuates by several degrees in cycles. PID control can be used with a solid state relay (SSR) to control the heater with much faster on/off cycles. This is a common modification to the this machine with several guides available online or as commercial kits, usually using an off the shelf temperature controller or Arduino for the more interested hobbyist. An Arduino is used for real time PID temperature control.  Unlike the raspberry pi it will operate consistently without interruption as well as having an analog to digital converter (ADC) for the temperature sensor.")]),t._v(" "),a("h2",{attrs:{id:"components"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#components"}},[t._v("#")]),t._v(" Components")]),t._v(" "),a("ul",[a("li",[t._v("Clion HHG1-1/032F-38 Solid State Relay (Generic Chinese)\n"),a("ul",[a("li",[t._v("Control voltage range 3-32 VDC")]),t._v(" "),a("li",[t._v("Output voltage range 24-440 VAC")]),t._v(" "),a("li",[t._v("Output maximum load 25 A (Plenty)")])])]),t._v(" "),a("li",[t._v("LM35DT temperature sensor ["),a("a",{attrs:{href:"https://www.ti.com/lit/ds/symlink/lm35.pdf",target:"_blank",rel:"noopener noreferrer"}},[t._v("datasheet"),a("OutboundLink")],1),t._v("]\n"),a("ul",[a("li",[t._v("−55°C to 150°C range")]),t._v(" "),a("li",[t._v("0.5°C accuracy @ 25°C")])])])]),t._v(" "),a("h2",{attrs:{id:"installation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[t._v("#")]),t._v(" Installation")]),t._v(" "),a("p",[t._v("In line with other Rancillio Silvia mods the heat relay was fastened behind the front cover panel above the drip tray using the existing fastener for the cable clamp (on other side). This is enough to hold it in place but a second hole was drilled above to fix the relay securely in place. The temperature sensor was screwed down using a threaded hole for the original thermostat.")]),t._v(" "),a("DocsImageLayout",{attrs:{images:t.$frontmatter.images_installation,srcBase:"/silvia/assets/build/"}}),t._v(" "),a("h2",{attrs:{id:"wiring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wiring"}},[t._v("#")]),t._v(" Wiring")]),t._v(" "),a("p",[t._v("The Arduino controls the PID I/O independently of the raspberry pi although the pi, connected via i2C can turn the operation on and off as well as change the setpoint and gains. A 10kΩ pull-down resistor is used to ensure the relay input is at 0V when the output in not high.")]),t._v(" "),a("DocsImageLayout",{attrs:{images:t.$frontmatter.images_wiring,size:"lg",srcBase:"/silvia/assets/build/"}}),t._v(" "),a("h2",{attrs:{id:"software"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#software"}},[t._v("#")]),t._v(" Software")]),t._v(" "),a("h3",{attrs:{id:"temperature-sensing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#temperature-sensing"}},[t._v("#")]),t._v(" Temperature sensing")]),t._v(" "),a("p",[t._v("To smooth the temperature readings a combination of averaging and a smoothing filter are used.")]),t._v(" "),a("p",[t._v("Temperature readings are summed up over a time period, counting the quantity:")]),t._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[t._v("reading_sum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("analogRead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sensor_pin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" sensor_coefficient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nreading_count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("After a set time interval these are then averaged and smoothed with respect to the previous value. The smoothing filter value controls the magnitude of this effect by biasing the value more or less towards the previously stored temperature:")]),t._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" average "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" reading_sum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" reading_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Apply smoothing")]),t._v("\nreading_new "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" average "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" smoothing_filter_val "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" reading_last "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" smoothing_filter_val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"pid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pid"}},[t._v("#")]),t._v(" PID")]),t._v(" "),a("p",[t._v("For the PID control the Arduino PID library ["),a("a",{attrs:{href:"https://github.com/br3ttb/Arduino-PID-Library/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Github"),a("OutboundLink")],1),t._v("] was used. To control the relay on/off output the technique was used as described in the "),a("a",{attrs:{href:"https://playground.arduino.cc/Code/PIDLibraryRelayOutputExample/",target:"_blank",rel:"noopener noreferrer"}},[t._v("relay example"),a("OutboundLink")],1),t._v(". This was wrapped up into a new class by inheriting from the libraries PID class, extending with the relay control function.")])],1)}),[],!1,null,null,null);e.default=s.exports}}]);